# `labeller`

<img src='src/dev/assets/logo.png' align="right" height="139" />

<!-- badges: start -->
[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

The goal of labeller is find, fix, an double-check common issues that arise when documenting data. This package is useful wherever variable and value labels are found, but particularly useful where those labels have been generated by [Survey Solutions](https://mysurvey.solutions/).

##  Installation

This package is installed from SSC. Installing from SSC will always install the most recent published and well-tested version of the package. This correspond to the version in the main branch on [the repo](https://github.com/lsms-worldbank/labeller).

```stata
ssc install labeller
```

You can test for updates by using this code. If there are updates Stata will instruct you how to apply them.

```stata
adoupdate repkit
```

### Advanced use cases

The installation methods below are advanced and we do not recommend the typical Stata user to install this package using either of these methods.

#### Un-published versions
If you need some yet to be published version of `labeller`, then you can use this code to install a version that is still in under development or testing. To install the version in a particular branch, set the local `tag` to the target branch you want to install from in this code:

```stata
local tag "dev"
net install labeller, ///
  from("https://raw.githubusercontent.com/lsms-worldbank/labeller/`tag'/src")
```

#### Previous versions
If you need to install a previously releases version of `labeller`, then you can use the following method. This can be useful, for example, during reproducibility verifications. To install the version in a particular release, set the local `tag` to the target release you want to install in this code:

```stata
local tag "v1.0"
net install labeller, ///
  from("https://raw.githubusercontent.com/lsms-worldbank/labeller/`tag'/src")
```

Note also: while this package does not require [selector](https://github.com/lsms-worldbank/selector), some commands in labeller do leverage the questionnaire metadata that selector adds to survey metadata.

## Commands

| Command | Description |
| --- | --- |
| [labeller](https://lsms-worldbank.github.io/labeller/reference/labeller.html) | Package command with utilities for the rest of the package
| [lbl_assert_no_long_varlbl](https://lsms-worldbank.github.io/labeller/reference/lbl_assert_no_long_varlbl.html) | Assert that there is no variable in memory whose variable length exceeds the desired character length. |
| [lbl_assert_no_pipes](https://lsms-worldbank.github.io/labeller/reference/lbl_assert_no_pipes.html) | Asserts that no variable labels have any pipes |
| [lbl_assert_have_varlbl](https://lsms-worldbank.github.io/labeller/reference/lbl_assert_have_varlbl.html) | List variables without a variable label. |
| [lbl_list_long_varlbl](https://lsms-worldbank.github.io/labeller/reference/lbl_list_long_varlbl.html) | List variables whose variable label is longer than the desired character length. |
| [lbl_list_matching_vars](https://lsms-worldbank.github.io/labeller/reference/lbl_list_matching_vars.html) | Identify variables whose label matches a pattern. |
| [lbl_list_matching_vals](https://lsms-worldbank.github.io/labeller/reference/lbl_list_matching_vals.html) | List value labels whose labels match a pattern. |
| [lbl_list_no_varlbl](https://lsms-worldbank.github.io/labeller/reference/lbl_list_no_varlbl.html) | List variables without a variable label. |
| [lbl_list_pipes](https://lsms-worldbank.github.io/labeller/reference/lbl_list_pipes.html) | Lists pipes in variable labels from Survey Solutions. |
| [lbl_replace_pipe](https://lsms-worldbank.github.io/labeller/reference/lbl_replace_pipe.html) | Replaces pipes in variable labels with user-provided value |

## Usage

More details on

- [What](#what) objects labeller manages
- [How](#how) it manages those objects

### What

- [Variable labels](#variable-labels)
- [Value labels](#value-labels)

#### Variable labels

```stata
* missing
lbl_list_no_varlbl

* too long
lbl_list_long_varlbl, maxlen(80)

* contains text...
* ... SuSo pipes
lbl_list_pipes
* ... some text
lbl_matches_vars "string to find"
```

#### Value labels

```stata
* unused
lbl_list_unused_lbls, verbose

* too long
lbl_list_long_vallbl, max(100)

* contains text
* for example, French characters
lbl_list_matching_vals, pattern("[àâäÀÂÄéèêëÉÈÊËîïôöÔÖùûüçÇ]")
```

### How

Provides functions for the full data documentation workflow:

- [List](#list) problems
- [Fix](#fix) them
- [Assert](#assert) everything has been addressed

#### List

Step 1: Take stock of the problem's scope

```stata
* list all pipes and all variables with those pipes
lbl_list_pipe
```

#### Fix

Step 2: Treat problems where they appear

```stata
* replace "%rostertitle% with "[NAME]" in all variable labels
lbl_replace_pipe, ///
  pipe("%rostertitle%") ///
  replacement("[NAME]")
```

#### Assert

Step 3: Confirm that all problems have been resolved

```stata
lbl_assert_no_pipes
```

## Learn more

To learn more about the package:

- Consult the reference documentation
- Read how-to articles

## Contact

LSMS Team, World Bank
lsms@worldbank.org
